<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>AgriTech Connect – Cart</title>
  <link
    href="https://cdn.jsdelivr.net/npm/tailwindcss@2.2.19/dist/tailwind.min.css"
    rel="stylesheet"
  />
  <link
    href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css"
    rel="stylesheet"
  />
  <script src="https://www.gstatic.com/firebasejs/9.6.10/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.6.10/firebase-auth-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.6.10/firebase-firestore-compat.js"></script>

  <style>
    .dark-mode {
      background-color: #1a202c;
      color: #edf2f7;
    }

    .logo-border {
      border: 4px solid #34d399; /* Tailwind green-400 */
      border-radius: 9999px; /* fully rounded */
      transition: border-color 0.3s ease, box-shadow 0.3s ease;
      box-shadow: 0 0 8px #34d399aa; /* subtle glow */
      cursor: pointer;
    }
    .logo-border:hover {
      border-color: #10b981; /* Tailwind green-500 */
      box-shadow: 0 0 15px #10b981dd; /* brighter glow */
    }
  </style>
</head>
<body
  id="main-body"
  class="flex bg-gray-100 text-gray-900 dark-mode:text-white"
>
  <aside
    class="w-64 bg-green-800 text-white p-4 hidden md:block min-h-screen sticky top-0"
  >
    <img
      src="logo.png"
      alt="AgriTech Connect Logo"
      class="w-32 mb-6 rounded-full logo-border"
      onclick="toggleSidebar()"
    />
    <nav class="space-y-3">
      <a href="dashboard.html" class="block hover:bg-green-700 p-2 rounded"
        >🏠 Dashboard</a
      >
      <a href="marketplace.html" class="block hover:bg-green-700 p-2 rounded"
        >🛒 Marketplace</a
      >
      <a href="learning.html" class="block hover:bg-green-700 p-2 rounded"
        >🎓 Learning Hub</a
      >
      <a href="weather.html" class="block hover:bg-green-700 p-2 rounded"
        >⛅ Weather</a
      >
      <a href="sickness.html" class="block hover:bg-green-700 p-2 rounded"
        >🩺 Crop Doctor</a
      >
      <a href="mentorship.html" class="block hover:bg-green-700 p-2 rounded"
        >👥 Mentorship</a
      >
      <a href="chat.html" class="block hover:bg-green-700 p-2 rounded"
        >💬 Community Chat</a
      >
      <a href="cart.html" class="block bg-green-700 p-2 rounded font-semibold"
        >🧺 Cart</a
      >
    </nav>
  </aside>

  <div class="flex-1 flex flex-col min-h-screen">
    <header
      class="bg-white shadow-md p-4 flex items-center justify-between sticky top-0 z-50"
    >
      <div class="flex items-center gap-2">
        <img
          src="logo.png"
          alt="Logo"
          class="w-10 h-10 rounded-full logo-border md:hidden"
          onclick="toggleSidebar()"
        />
        <h1 class="text-xl font-bold">Cart</h1>
      </div>
      <div class="flex items-center gap-4">
        <button onclick="toggleDarkMode()" class="text-lg">
          <i class="fas fa-moon"></i>
        </button>
        <div class="relative">
          <img
            id="userPhoto"
            src="https://via.placeholder.com/32"
            class="w-8 h-8 rounded-full cursor-pointer"
            onclick="toggleMenu()"
          />
          <div
            id="dropdownMenu"
            class="absolute right-0 mt-2 bg-white shadow-md rounded hidden p-2 w-40 text-black"
          >
            <p class="text-sm" id="userName">User</p>
            <hr class="my-1" />
            <a
              href="profile.html"
              class="block text-sm py-1 hover:bg-gray-100"
              >⚙️ Profile</a
            >
            <button
              onclick="logout()"
              class="w-full text-left text-sm py-1 hover:bg-gray-100"
            >
              🚪 Logout
            </button>
          </div>
        </div>
      </div>
    </header>

    <main class="p-6 space-y-6 flex-1 flex flex-col">
      <section>
        <h2 class="text-lg font-semibold mb-4">🧺 Your Cart</h2>
        <div id="cartItems" class="space-y-4"></div>
        <div id="cartTotal" class="mt-6 font-semibold text-right text-lg"></div>
        <button
          id="checkoutButton"
          class="mt-4 bg-green-700 text-white px-6 py-2 rounded hover:bg-green-800 disabled:opacity-50"
          disabled
        >
          Proceed to Checkout
        </button>
      </section>
    </main>
  </div>

  <script>
    const firebaseConfig = {
      apiKey: "AIzaSyBLHgzcY_VdE_F5BzEahc6EY5dfSRgLeDw",
      authDomain: "agritechconnect-1d52b.firebaseapp.com",
      projectId: "agritechconnect-1d52b",
    };
    firebase.initializeApp(firebaseConfig);
    const auth = firebase.auth();
    const db = firebase.firestore();

    let currentUser = null;
    let cart = [];

    auth.onAuthStateChanged((user) => {
      if (user) {
        currentUser = user;
        document.getElementById("userName").textContent =
          user.displayName || user.email;
        document.getElementById("userPhoto").src =
          user.photoURL || "https://via.placeholder.com/32";
        loadCart();
      } else {
        window.location.href = "index.html";
      }
    });

    function logout() {
      auth.signOut();
    }
    function toggleMenu() {
      document.getElementById("dropdownMenu").classList.toggle("hidden");
    }
    function toggleSidebar() {
      document.querySelector("aside").classList.toggle("hidden");
    }
    function toggleDarkMode() {
      document.getElementById("main-body").classList.toggle("dark-mode");
    }

    async function loadCart() {
      const cartRef = db
        .collection("carts")
        .doc(currentUser.uid)
        .collection("items");

      const snapshot = await cartRef.get();
      cart = [];
      snapshot.forEach((doc) => {
        cart.push({ id: doc.id, ...doc.data() });
      });

      renderCart();
    }

    function renderCart() {
      const cartItemsDiv = document.getElementById("cartItems");
      const cartTotalDiv = document.getElementById("cartTotal");
      const checkoutButton = document.getElementById("checkoutButton");
      cartItemsDiv.innerHTML = "";

      if (cart.length === 0) {
        cartItemsDiv.innerHTML =
          '<p class="text-gray-600 dark:text-gray-400">Your cart is empty.</p>';
        cartTotalDiv.textContent = "";
        checkoutButton.disabled = true;
        return;
      }

      let total = 0;
      cart.forEach((item) => {
        total += item.price * item.quantity;
        const itemDiv = document.createElement("div");
        itemDiv.className =
          "flex items-center justify-between bg-white p-3 rounded shadow-sm dark:bg-gray-800";

        itemDiv.innerHTML = `
          <div>
            <h3 class="font-semibold">${item.name}</h3>
            <p class="text-sm text-gray-600 dark:text-gray-300">R ${item.price} × ${item.quantity}</p>
          </div>
          <div class="flex items-center gap-2">
            <button onclick="updateQuantity('${item.id}', ${item.quantity - 1})" class="px-2 bg-gray-300 rounded hover:bg-gray-400">−</button>
            <span>${item.quantity}</span>
            <button onclick="updateQuantity('${item.id}', ${item.quantity + 1})" class="px-2 bg-gray-300 rounded hover:bg-gray-400">+</button>
            <button onclick="removeItem('${item.id}')" class="ml-4 text-red-600 hover:text-red-800"><i class="fas fa-trash"></i></button>
          </div>
        `;
        cartItemsDiv.appendChild(itemDiv);
      });

      cartTotalDiv.textContent = `Total: R ${total.toFixed(2)}`;
      checkoutButton.disabled = false;
    }

    async function updateQuantity(itemId, newQty) {
      if (newQty < 1) return;
      const itemIndex = cart.findIndex((i) => i.id === itemId);
      if (itemIndex === -1) return;
      cart[itemIndex].quantity = newQty;
      await db
        .collection("carts")
        .doc(currentUser.uid)
        .collection("items")
        .doc(itemId)
        .update({ quantity: newQty });
      renderCart();
    }

    async function removeItem(itemId) {
      await db
        .collection("carts")
        .doc(currentUser.uid)
        .collection("items")
        .doc(itemId)
        .delete();
      cart = cart.filter((i) => i.id !== itemId);
      renderCart();
    }

    document
      .getElementById("checkoutButton")
      .addEventListener("click", () => alert("Checkout functionality coming soon!"));
  </script>
</body>
</html>
