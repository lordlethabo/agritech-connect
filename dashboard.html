<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Weather Alerts - AgriTech Connect</title>

  <!-- Chart.js -->
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>

  <!-- Awesomplete for Autocomplete -->
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/awesomplete/1.1.5/awesomplete.min.css" />
  <script src="https://cdnjs.cloudflare.com/ajax/libs/awesomplete/1.1.5/awesomplete.min.js"></script>

  <style>
    body {
      font-family: 'Segoe UI', sans-serif;
      background-color: #f3f5f0;
      margin: 0;
      padding: 0;
    }

    .weather-section {
      max-width: 700px;
      margin: 40px auto;
      padding: 20px;
      background-color: #ffffff;
      border-radius: 16px;
      box-shadow: 0 8px 16px rgba(0, 0, 0, 0.08);
    }

    .weather-section h2 {
      text-align: center;
      color: #496b3f;
      margin-bottom: 24px;
    }

    #weather-location {
      width: 100%;
      padding: 12px;
      border-radius: 12px;
      border: 1px solid #a3b18a;
      font-size: 1rem;
      margin-bottom: 12px;
    }

    button {
      width: 100%;
      padding: 12px;
      background-color: #7ca982;
      color: white;
      border: none;
      border-radius: 12px;
      font-size: 1rem;
      cursor: pointer;
      transition: background-color 0.3s ease;
    }

    button:hover {
      background-color: #5a7d55;
    }

    #weather-result {
      margin-top: 16px;
      color: #333;
      text-align: center;
    }

    canvas {
      margin-top: 30px;
      max-width: 100%;
    }

    @media (max-width: 600px) {
      .weather-section {
        padding: 15px;
        margin: 20px;
      }
    }
  </style>
</head>

<body>
  <section class="weather-section" id="weather-alerts">
    <h2>üå¶Ô∏è Weather Alerts</h2>

    <input 
      type="text" 
      id="weather-location" 
      placeholder="Enter town (e.g. Lebowakgomo)" 
      class="awesomplete"
      autocomplete="off"
    />

    <button onclick="getWeather()">Check Weather</button>

    <div id="weather-result"></div>

    <canvas id="weatherChart"></canvas>
  </section>

  <script>
    const weatherApiKey = "4e964608f63e83461ebc8ef5ea65e997"; // OpenWeatherMap API key
    let weatherChart = null;

    const townNames = [
      "Lebowakgomo", "Polokwane", "Thohoyandou", "Jane Furse", "Giyani", "Makhado", "Tzaneen",
      "Bela-Bela", "Mokopane", "Musina", "Burgersfort", "Louis Trichardt", "Groblersdal",
      "Modimolle", "Phalaborwa", "Zebediela", "Pretoria", "Johannesburg", "Durban", "Cape Town"
    ];

    new Awesomplete(document.getElementById("weather-location"), {
      list: townNames,
      minChars: 1,
      maxItems: 6,
      autoFirst: true
    });

    function getWeather() {
      const location = document.getElementById("weather-location").value.trim();
      const resultBox = document.getElementById("weather-result");
      const ctx = document.getElementById("weatherChart").getContext('2d');

      if (!location) {
        resultBox.innerHTML = "<p style='color: red;'>Please enter a town name.</p>";
        return;
      }

      resultBox.innerHTML = "<p>Fetching weather data...</p>";

      fetch(`https://api.openweathermap.org/data/2.5/weather?q=${location}&units=metric&appid=${weatherApiKey}`)
        .then(response => {
          if (!response.ok) throw new Error("Town not found.");
          return response.json();
        })
        .then(data => {
          const desc = data.weather[0].description;
          const temp = data.main.temp;
          const feelsLike = data.main.feels_like;
          const humidity = data.main.humidity;
          const wind = data.wind.speed;
          const pressure = data.main.pressure;

          resultBox.innerHTML = `
            <p><strong>Weather:</strong> ${desc}</p>
            <p><strong>Temperature:</strong> ${temp}¬∞C</p>
            <p><strong>Feels Like:</strong> ${feelsLike}¬∞C</p>
            <p><strong>Humidity:</strong> ${humidity}%</p>
            <p><strong>Wind Speed:</strong> ${wind} m/s</p>
            <p><strong>Pressure:</strong> ${pressure} hPa</p>
          `;

          const chartData = {
            labels: ['Temperature (¬∞C)', 'Feels Like', 'Humidity (%)', 'Wind Speed (m/s)', 'Pressure (hPa)'],
            datasets: [{
              label: `Weather in ${location}`,
              data: [temp, feelsLike, humidity, wind, pressure],
              backgroundColor: [
                '#b7d3a8',
                '#a3b18a',
                '#ccd5ae',
                '#d4a373',
                '#6b705c'
              ],
              borderRadius: 10
            }]
          };

          const chartOptions = {
            indexAxis: 'y',
            responsive: true,
            plugins: {
              legend: { display: false }
            },
            scales: {
              x: { beginAtZero: true }
            }
          };

          if (weatherChart) weatherChart.destroy();

          weatherChart = new Chart(ctx, {
            type: 'bar',
            data: chartData,
            options: chartOptions
          });
        })
        .catch(error => {
          resultBox.innerHTML = `<p style="color:red;">${error.message}</p>`;
          if (weatherChart) {
            weatherChart.destroy();
            weatherChart = null;
          }
        });
    }
  </script>
</body>
</html>
