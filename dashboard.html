<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>AgriTech Connect – Dashboard</title>
  <script src="https://www.gstatic.com/firebasejs/9.22.1/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.22.1/firebase-auth-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.22.1/firebase-firestore-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.22.1/firebase-storage-compat.js"></script>
  <link href="https://cdn.jsdelivr.net/npm/tailwindcss@2.2.19/dist/tailwind.min.css" rel="stylesheet" />
  <style>
    .feature-tile {
      @apply flex flex-col items-center justify-center bg-white p-6 rounded-xl shadow text-center text-green-800 font-medium text-lg hover:scale-105 transition transform duration-200;
    }
    .feature-tile span {
      margin-top: 0.5rem;
      font-size: 1rem;
    }
    #sidebar.show {
      transform: translateX(0) !important;
    }
  </style>
</head>
<body class="bg-gray-100">
  <!-- Header -->
  <header class="fixed top-0 left-0 w-full bg-white shadow-md z-50 flex items-center justify-between px-4 py-3 md:px-8">
    <div class="flex items-center space-x-3">
      <img src="logo.png" alt="AgriTech Logo" class="w-10 h-10 rounded-full shadow hover:scale-105 transition" />
      <span class="text-lg md:text-xl font-semibold text-green-800">AgriTech Innovators Connect</span>
    </div>
    <div class="flex items-center space-x-4">
      <div class="relative">
        <button id="notifBtn" class="text-gray-700 hover:text-green-700 focus:outline-none text-xl">🔔</button>
        <span class="absolute -top-1 -right-1 bg-red-500 text-white text-xs font-bold px-1.5 py-0.5 rounded-full animate-pulse">3</span>
      </div>
      <button id="menuToggle" class="text-2xl text-gray-700 hover:text-green-800 focus:outline-none md:hidden">☰</button>
    </div>
  </header>
  <div class="pt-20"></div>

  <!-- Sidebar -->
  <aside id="sidebar" class="fixed top-0 left-0 h-full w-64 bg-white border-r border-gray-200 shadow-lg z-40 transform -translate-x-full transition-transform duration-300 ease-in-out md:translate-x-0 hidden md:block">
    <div class="p-4 text-center">
      <img src="https://via.placeholder.com/80" alt="User Photo" id="userPhoto" class="w-20 h-20 rounded-full mx-auto mb-2 shadow" />
      <h2 id="userName" class="text-lg font-semibold text-green-800">John Doe</h2>
      <p id="userBio" class="text-sm text-gray-600">Farmer & Innovator</p>
      <p id="userLocation" class="text-xs text-gray-400 mt-1">Limpopo, South Africa</p>
      <div class="mt-6 space-y-3">
        <button id="logoutBtn" onclick="logout()" class="w-full bg-red-500 text-white py-2 rounded hover:bg-red-600">Log Out</button>
        <button id="roleSwitchBtn" onclick="openRoleSwitcher()" class="w-full bg-green-600 text-white py-2 rounded hover:bg-green-700 hidden">Switch Role</button>
      </div>
    </div>
  </aside>

  <!-- Main Dashboard Content -->
  <main class="ml-0 md:ml-64 p-4 md:p-8 bg-gray-50 min-h-screen transition-all duration-300">
    <h1 class="text-2xl font-semibold text-green-800 mb-6">Welcome to Your Dashboard</h1>
    <div class="grid grid-cols-2 sm:grid-cols-2 md:grid-cols-3 lg:grid-cols-4 gap-6">
      <a href="learning.html" class="feature-tile">📚<span>Learning Hub</span></a>
      <a href="marketplace.html" class="feature-tile">🛒<span>Marketplace</span></a>
      <a href="weather.html" class="feature-tile">☀️<span>Weather</span></a>
      <a href="sickness.html" class="feature-tile">🧬<span>Sickness Diagnosis</span></a>
      <a href="mentorship.html" class="feature-tile">👨‍🏫<span>Mentorship</span></a>
      <a href="community.html" class="feature-tile">🤝<span>Community</span></a>
      <a href="chat.html" class="feature-tile">💬<span>Chat</span></a>
      <a href="cart.html" class="feature-tile">🧺<span>Cart</span></a>
      <a href="notifications.html" class="feature-tile">🔔<span>Notifications</span></a>
    </div>
  </main>

  <!-- Role Switch Modal -->
  <div id="roleModal" class="fixed inset-0 z-50 flex items-center justify-center bg-black bg-opacity-50 hidden">
    <div class="bg-white w-full max-w-md rounded-xl shadow-lg p-6 text-center">
      <h2 class="text-xl font-semibold text-green-800 mb-4">Switch Your Role</h2>
      <p class="text-sm text-gray-600 mb-6">Choose how you'd like to use the platform now:</p>
      <div id="roleOptions" class="space-y-3 mb-6"></div>
      <button onclick="closeRoleModal()" class="text-sm text-gray-600 hover:text-red-600">Cancel</button>
    </div>
  </div>

  <!-- Firebase Scripts -->
  <script>
    const firebaseConfig = {
      apiKey: "AIzaSyBLHgzcY_VdE_F5BzEahc6EY5dfSRgLeDw",
      authDomain: "agritechconnect.firebaseapp.com",
      projectId: "agritechconnect-1d52b",
      storageBucket: "agritechconnect.appspot.com",
      messagingSenderId: "1027312049739",
      appId: "1:1027312049739:web:d4475b869a027b767cb7ce"
    };
    firebase.initializeApp(firebaseConfig);
    const auth = firebase.auth();
    const db = firebase.firestore();
    const storage = firebase.storage();

    auth.onAuthStateChanged(async (user) => {
      if (!user) return (window.location.href = "index.html");
      const doc = await db.collection("users").doc(user.uid).get();
      const data = doc.data();
      document.getElementById("userName").textContent = data.displayName || "No Name";
      document.getElementById("userBio").textContent = data.bio || "No bio provided";
      document.getElementById("userLocation").textContent = data.location || "No location set";
      if (data.photoURL) document.getElementById("userPhoto").src = data.photoURL;
      if (["admin", "mentor", "seller"].includes(data.role)) document.getElementById("roleSwitchBtn").classList.remove("hidden");
    });

    function logout() {
      auth.signOut().then(() => window.location.href = "index.html");
    }

    function openRoleSwitcher() {
      document.getElementById("roleModal").classList.remove("hidden");
      const uid = auth.currentUser?.uid;
      if (!uid) return;
      const roleOptions = document.getElementById("roleOptions");
      roleOptions.innerHTML = "<p>Loading roles...</p>";
      db.collection("users").doc(uid).get().then(doc => {
        const data = doc.data();
        const roles = data.roles || [data.role || "buyer"];
        roleOptions.innerHTML = "";
        roles.forEach(role => {
          const btn = document.createElement("button");
          btn.textContent = role.charAt(0).toUpperCase() + role.slice(1);
          btn.className = "w-full bg-green-600 text-white py-2 rounded hover:bg-green-700";
          btn.onclick = () => switchUserRole(role);
          roleOptions.appendChild(btn);
        });
      });
    }

    function closeRoleModal() {
      document.getElementById("roleModal").classList.add("hidden");
    }

    function switchUserRole(newRole) {
      const uid = auth.currentUser?.uid;
      if (!uid) return;
      db.collection("users").doc(uid).update({ role: newRole }).then(() => {
        alert("✅ Switched to " + newRole);
        closeRoleModal();
        location.reload();
      });
    }

    document.getElementById("menuToggle").addEventListener("click", () => {
      const sidebar = document.getElementById("sidebar");
      sidebar.classList.toggle("hidden");
      sidebar.classList.toggle("show");
    });
  </script>
</body>
</html>
