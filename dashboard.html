<!DOCTYPE html>
<html lang="en">
<head>
Â  <meta charset="UTF-8" />
Â  <meta name="viewport" content="width=device-width, initial-scale=1" />
Â  <title>AgriTech Connect â€“ Dashboard</title>
Â  <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;600&display=swap" rel="stylesheet" />
Â  <style>
Â  Â  body {
Â  Â  Â  font-family: 'Poppins', sans-serif;
Â  Â  Â  margin: 0;
Â  Â  Â  background: #f4fff1;
Â  Â  Â  color: #2e7d32;
Â  Â  }
Â  Â  header {
Â  Â  Â  background: #81c784;
Â  Â  Â  color: white;
Â  Â  Â  padding: 15px 30px;
Â  Â  Â  display: flex;
Â  Â  Â  align-items: center;
Â  Â  Â  justify-content: space-between;
Â  Â  }
Â  Â  header h1 {
Â  Â  Â  margin: 0;
Â  Â  Â  font-weight: 600;
Â  Â  }
Â  Â  #signOutBtn {
Â  Â  Â  background: #66bb6a;
Â  Â  Â  border: none;
Â  Â  Â  color: white;
Â  Â  Â  padding: 10px 18px;
Â  Â  Â  border-radius: 10px;
Â  Â  Â  cursor: pointer;
Â  Â  Â  font-weight: 600;
Â  Â  }
Â  Â  #signOutBtn:hover {
Â  Â  Â  background: #4caf50;
Â  Â  }
Â  Â  main {
Â  Â  Â  padding: 30px;
Â  Â  Â  max-width: 900px;
Â  Â  Â  margin: 0 auto;
Â  Â  }
Â  Â  .profile-section {
Â  Â  Â  background: white;
Â  Â  Â  padding: 20px;
Â  Â  Â  border-radius: 15px;
Â  Â  Â  box-shadow: 0 4px 10px rgba(0,0,0,0.1);
Â  Â  Â  margin-bottom: 30px;
Â  Â  Â  display: flex;
Â  Â  Â  align-items: center;
Â  Â  Â  gap: 20px;
Â  Â  }
Â  Â  .profile-pic {
Â  Â  Â  width: 100px;
Â  Â  Â  height: 100px;
Â  Â  Â  border-radius: 50%;
Â  Â  Â  object-fit: cover;
Â  Â  Â  border: 2px solid #81c784;
Â  Â  }
Â  Â  .profile-info {
Â  Â  Â  flex-grow: 1;
Â  Â  }
Â  Â  .profile-info h2 {
Â  Â  Â  margin: 0 0 6px;
Â  Â  }
Â  Â  .input-group {
Â  Â  Â  margin-top: 10px;
Â  Â  }
Â  Â  input[type="file"], input[type="text"] {
Â  Â  Â  padding: 8px;
Â  Â  Â  border-radius: 8px;
Â  Â  Â  border: 1px solid #ccc;
Â  Â  Â  width: 100%;
Â  Â  Â  font-size: 14px;
Â  Â  }
Â  Â  button.upload-btn {
Â  Â  Â  margin-top: 10px;
Â  Â  Â  padding: 10px 15px;
Â  Â  Â  background-color: #81c784;
Â  Â  Â  border: none;
Â  Â  Â  color: white;
Â  Â  Â  font-weight: 600;
Â  Â  Â  border-radius: 12px;
Â  Â  Â  cursor: pointer;
Â  Â  }
Â  Â  button.upload-btn:hover {
Â  Â  Â  background-color: #66bb6a;
Â  Â  }
Â  Â  section {
Â  Â  Â  background: white;
Â  Â  Â  border-radius: 15px;
Â  Â  Â  padding: 20px;
Â  Â  Â  margin-bottom: 30px;
Â  Â  Â  box-shadow: 0 4px 10px rgba(0,0,0,0.05);
Â  Â  }
Â  Â  section h3 {
Â  Â  Â  margin-top: 0;
Â  Â  }
Â  Â  #message {
Â  Â  Â  margin-top: 10px;
Â  Â  Â  color: red;
Â  Â  Â  font-weight: 600;
Â  Â  }
Â  </style>

Â  <script src="https://www.gstatic.com/firebasejs/9.22.1/firebase-app-compat.js"></script>
Â  <script src="https://www.gstatic.com/firebasejs/9.22.1/firebase-auth-compat.js"></script>
Â  <script src="https://www.gstatic.com/firebasejs/9.22.1/firebase-firestore-compat.js"></script>
Â  <script src="https://www.gstatic.com/firebasejs/9.22.1/firebase-storage-compat.js"></script>
</head>
<body>
Â  <header>
Â  Â  <h1>AgriTech Connect</h1>
Â  Â  <button id="signOutBtn" aria-label="Sign out">Sign Out</button>
Â  </header>
Â  <main>
Â  Â  <section class="profile-section" aria-label="User Profile">
Â  Â  Â  <img id="profilePic" src="default-profile.png" alt="Profile Picture" class="profile-pic" />
Â  Â  Â  <div class="profile-info">
Â  Â  Â  Â  <h2 id="displayName">Loading...</h2>
Â  Â  Â  Â  <p id="emailDisplay"></p>
Â  Â  Â  Â  <p><strong>Role:</strong> <span id="roleDisplay">Loading...</span></p>
Â  Â  Â  Â  <div class="input-group">
Â  Â  Â  Â  Â  <label for="profileHeading">Profile Heading / Bio:</label>
Â  Â  Â  Â  Â  <input type="text" id="profileHeading" placeholder="Write a heading or bio for your profile" />
Â  Â  Â  Â  Â  <button class="upload-btn" id="saveHeadingBtn">Save Heading</button>
Â  Â  Â  Â  Â  <div id="headingMsg" role="alert" aria-live="polite"></div>
Â  Â  Â  Â  </div>
Â  Â  Â  Â  <div class="input-group">
Â  Â  Â  Â  Â  <label for="profileImageUpload">Upload Profile Picture:</label>
Â  Â  Â  Â  Â  <input type="file" id="profileImageUpload" accept="image/*" />
Â  Â  Â  Â  Â  <button class="upload-btn" id="uploadProfilePicBtn">Upload Picture</button>
Â  Â  Â  Â  Â  <div id="uploadMsg" role="alert" aria-live="polite"></div>
Â  Â  Â  Â  </div>
Â  Â  Â  </div>
Â  Â  </section>

Â  Â  <!-- Buyer Section -->
Â  Â  <section id="buyerSection" style="display:none;">
Â  Â  Â  <h3>ğŸ›’ Marketplace</h3>
Â  Â  Â  <p>Here you can browse produce and livestock for sale from sellers.</p>
Â  Â  Â  <!-- Marketplace dynamic content will go here -->
Â  Â  </section>

Â  Â  <!-- Seller Section -->
Â  Â  <section id="sellerSection" style="display:none;">
Â  Â  Â  <h3>ğŸ“¦ Your Products & Livestock for Sale</h3>
Â  Â  Â  <p>Upload photos and details of the products or livestock you want to sell.</p>
Â  Â  Â  <!-- Upload & product management UI to be added -->
Â  Â  </section>

Â  Â  <!-- Mentor Section -->
Â  Â  <section id="mentorSection" style="display:none;">
Â  Â  Â  <h3>ğŸ¤ Mentorship</h3>
Â  Â  Â  <p>Access mentorship requests and provide guidance to farmers.</p>
Â  Â  Â  <!-- Mentorship dashboard content here -->
Â  Â  </section>

Â  Â  <!-- Admin Section -->
Â  Â  <section id="adminSection" style="display:none;">
Â  Â  Â  <h3>âš™ï¸ Admin Panel</h3>
Â  Â  Â  <p>Manage users, products, and site content.</p>
Â  Â  Â  <!-- Admin management tools here -->
Â  Â  </section>
Â  </main>

Â  <script>
Â  Â  const firebaseConfig = {
Â  Â  Â  apiKey: "AIzaSyBLHgzcY_VdE_F5BzEahc6EY5dfSRgLeDw",
Â  Â  Â  authDomain: "agritechconnect.firebaseapp.com",
Â  Â  Â  projectId: "agritechconnect-1d52b",
Â  Â  Â  storageBucket: "agritechconnect.appspot.com",
Â  Â  Â  messagingSenderId: "1027312049739",
Â  Â  Â  appId: "1:1027312049739:web:d4475b869a027b767cb7ce"
Â  Â  };

Â  Â  firebase.initializeApp(firebaseConfig);
Â  Â  const auth = firebase.auth();
Â  Â  const db = firebase.firestore();
Â  Â  const storage = firebase.storage();

Â  Â  const profilePic = document.getElementById("profilePic");
Â  Â  const displayNameEl = document.getElementById("displayName");
Â  Â  const emailDisplay = document.getElementById("emailDisplay");
Â  Â  const roleDisplay = document.getElementById("roleDisplay");
Â  Â  const profileHeadingInput = document.getElementById("profileHeading");
Â  Â  const saveHeadingBtn = document.getElementById("saveHeadingBtn");
Â  Â  const headingMsg = document.getElementById("headingMsg");
Â  Â  const profileImageUpload = document.getElementById("profileImageUpload");
Â  Â  const uploadProfilePicBtn = document.getElementById("uploadProfilePicBtn");
Â  Â  const uploadMsg = document.getElementById("uploadMsg");

Â  Â  const buyerSection = document.getElementById("buyerSection");
Â  Â  const sellerSection = document.getElementById("sellerSection");
Â  Â  const mentorSection = document.getElementById("mentorSection");
Â  Â  const adminSection = document.getElementById("adminSection");

Â  Â  let currentUserUID = null;
Â  Â  let userDocRef = null;

Â  Â  // Redirect if not logged in, else load user info
Â  Â  auth.onAuthStateChanged(async (user) => {
Â  Â  Â  if (!user) {
Â  Â  Â  Â  window.location.href = "index.html";
Â  Â  Â  Â  return;
Â  Â  Â  }
Â  Â  Â  currentUserUID = user.uid;
Â  Â  Â  userDocRef = db.collection("users").doc(currentUserUID);

Â  Â  Â  // Load user profile from Firestore
Â  Â  Â  const doc = await userDocRef.get();
Â  Â  Â  if (!doc.exists) {
Â  Â  Â  Â  // If no user doc, create default
Â  Â  Â  Â  await userDocRef.set({
Â  Â  Â  Â  Â  displayName: user.displayName || "Unknown User",
Â  Â  Â  Â  Â  email: user.email,
Â  Â  Â  Â  Â  role: "buyer",
Â  Â  Â  Â  Â  photoURL: user.photoURL || "",
Â  Â  Â  Â  Â  profileHeading: "",
Â  Â  Â  Â  Â  createdAt: firebase.firestore.FieldValue.serverTimestamp()
Â  Â  Â  Â  });
Â  Â  Â  Â  displayUserProfile(user.displayName || "Unknown User", user.email, "buyer", user.photoURL || "", "");
Â  Â  Â  Â  showRoleSections("buyer");
Â  Â  Â  } else {
Â  Â  Â  Â  const data = doc.data();
Â  Â  Â  Â  displayUserProfile(data.displayName, data.email, data.role, data.photoURL, data.profileHeading || "");
Â  Â  Â  Â  showRoleSections(data.role);
Â  Â  Â  }

Â  Â  });

Â  Â  // Display profile info on page
Â  Â  function displayUserProfile(name, email, role, photoURL, heading) {
Â  Â  Â  displayNameEl.textContent = name;
Â  Â  Â  emailDisplay.textContent = email;
Â  Â  Â  roleDisplay.textContent = role;
Â  Â  Â  profileHeadingInput.value = heading;
Â  Â  Â  profilePic.src = photoURL && photoURL !== "" ? photoURL : "default-profile.png";
Â  Â  }

Â  Â  // Show relevant sections based on role
Â  Â  function showRoleSections(role) {
Â  Â  Â  buyerSection.style.display = "none";
Â  Â  Â  sellerSection.style.display = "none";
Â  Â  Â  mentorSection.style.display = "none";
Â  Â  Â  adminSection.style.display = "none";

Â  Â  Â  if (role === "buyer") buyerSection.style.display = "block";
Â  Â  Â  if (role === "seller") sellerSection.style.display = "block";
Â  Â  Â  if (role === "mentor") mentorSection.style.display = "block";
Â  Â  Â  if (role === "admin") adminSection.style.display = "block";

Â  Â  Â  // Users can have multiple roles; expand this if you want multi-role UI display
Â  Â  }

Â  Â  // Save profile heading to Firestore
Â  Â  saveHeadingBtn.addEventListener("click", async () => {
Â  Â  Â  const newHeading = profileHeadingInput.value.trim();
Â  Â  Â  headingMsg.style.color = "red";
Â  Â  Â  headingMsg.textContent = "";

Â  Â  Â  if (!newHeading) {
Â  Â  Â  Â  headingMsg.textContent = "Heading cannot be empty.";
Â  Â  Â  Â  return;
Â  Â  Â  }
Â  Â  Â  try {
Â  Â  Â  Â  await userDocRef.update({ profileHeading: newHeading });
Â  Â  Â  Â  headingMsg.style.color = "green";
Â  Â  Â  Â  headingMsg.textContent = "Heading updated successfully!";
Â  Â  Â  } catch (error) {
Â  Â  Â  Â  headingMsg.textContent = "Error updating heading: " + error.message;
Â  Â  Â  }
Â  Â  });

Â  Â  // Upload profile picture
Â  Â  uploadProfilePicBtn.addEventListener("click", () => {
Â  Â  Â  uploadMsg.style.color = "red";
Â  Â  Â  uploadMsg.textContent = "";

Â  Â  Â  const file = profileImageUpload.files[0];
Â  Â  Â  if (!file) {
Â  Â  Â  Â  uploadMsg.textContent = "Please select an image file first.";
Â  Â  Â  Â  return;
Â  Â  Â  }

Â  Â  Â  const storageRef = storage.ref();
Â  Â  Â  const profilePicRef = storageRef.child(`profilePics/${currentUserUID}_${file.name}`);

Â  Â  Â  // Upload file
Â  Â  Â  const uploadTask = profilePicRef.put(file);

Â  Â  Â  uploadTask.on('state_changed', 
Â  Â  Â  Â  (snapshot) => {
Â  Â  Â  Â  Â  // Optional: Can add progress bar here
Â  Â  Â  Â  }, 
Â  Â  Â  Â  (error) => {
Â  Â  Â  Â  Â  uploadMsg.textContent = "Upload failed: " + error.message;
Â  Â  Â  Â  }, 
Â  Â  Â  Â  () => {
Â  Â  Â  Â  Â  uploadTask.snapshot.ref.getDownloadURL().then(async (downloadURL) => {
Â  Â  Â  Â  Â  Â  // Update Firestore and Firebase user profile photoURL
Â  Â  Â  Â  Â  Â  await userDocRef.update({ photoURL: downloadURL });
Â  Â  Â  Â  Â  Â  await auth.currentUser.updateProfile({ photoURL: downloadURL });

Â  Â  Â  Â  Â  Â  profilePic.src = downloadURL;
Â  Â  Â  Â  Â  Â  uploadMsg.style.color = "green";
Â  Â  Â  Â  Â  Â  uploadMsg.textContent = "Profile picture updated!";
Â  Â  Â  Â  Â  });
Â  Â  Â  Â  }
Â  Â  Â  );
Â  Â  });

Â  Â  // Sign out
Â  Â  document.getElementById("signOutBtn").addEventListener("click", () => {
Â  Â  Â  auth.signOut().then(() => {
Â  Â  Â  Â  window.location.href = "index.html";
Â  Â  Â  });
Â  Â  });
Â  </script>
</body>
</html>
